<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EDA - NYC Taxi Dataset</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
       background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#333; padding:20px; }
.container { max-width:1400px; margin:0 auto; }
header { background:white; padding:30px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); margin-bottom:30px; }
h1 { color:#667eea; margin-bottom:10px; }
.subtitle { color:#666; font-size:14px; }
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-bottom:30px; }
.stat-card { background:white; padding:25px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); transition:transform 0.2s; }
.stat-card:hover { transform:translateY(-5px); }
.stat-label { font-size:12px; color:#666; text-transform:uppercase; letter-spacing:1px; margin-bottom:10px; }
.stat-value { font-size:32px; font-weight:bold; color:#667eea; }
.stat-detail { font-size:14px; color:#999; margin-top:5px; }
.charts-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(500px,1fr)); gap:20px; margin-bottom:30px; }
.chart-card { background:white; padding:25px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); }
.chart-title { font-size:18px; font-weight:600; margin-bottom:20px; color:#333; }
.chart-container { position:relative; height:300px; }
.data-table { background:white; padding:25px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); overflow-x:auto; }
table { width:100%; border-collapse:collapse; }
th, td { padding:12px; text-align:left; border-bottom:1px solid #eee; }
th { background:#f8f9fa; font-weight:600; color:#667eea; }
tr:hover { background:#f8f9fa; }
footer { text-align:center; color:white; margin-top:40px; padding:20px; opacity:0.8; }
#scatterPlot, #passengerPlot, #paymentPlot { width:100%; height:400px; }
</style>
</head>
<body>
<div class="container">
<header>
    <h1>Análisis Exploratorio de Datos (EDA)</h1>
    <p class="subtitle">NYC Taxi Dataset - Dashboard Interactivo</p>
    <h4>Esta base de datos contiene información de más de 1,369,765 viajes de taxis y 18 columnas.
        Algunas columnas tienen valores nulos. Las columnas sin nulos incluyen tpep_pickup_datetime, tpep_dropoff_datetime, trip_distance, PULocationID, DOLocationID y las relacionadas con la tarifa (fare_amount, tip_amount, etc.).
    Para este analisis se tienen en cuenta trip_distance, total_amount, passenger_count, tip_amount.
    </h4>
</header>

<!-- Estadísticas -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">Total de Registros</div>
        <div class="stat-value">{{ "{:,}".format(stats.total_registros) }}</div>
        <div class="stat-detail">Viajes registrados</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Columnas</div>
        <div class="stat-value">{{ stats.total_columnas }}</div>
        <div class="stat-detail">Variables en el dataset</div>
    </div>
    {% if stats.trip_distance %}
    <div class="stat-card">
        <div class="stat-label">Distancia (millas)</div>
        <div class="stat-value">{{ "%.2f"|format(stats.trip_distance.mean) }} mi</div>
        <div class="stat-detail">
            Mediana: {{ "%.2f"|format(stats.trip_distance.median) }} mi<br>
            Mín: {{ "%.2f"|format(stats.trip_distance.min) }} mi<br>
            Máx: {{ "%.2f"|format(stats.trip_distance.max) }} mi<br>
            Desv. Estándar: {{ "%.2f"|format(stats.trip_distance.std) }} mi
        </div>
    </div>
    {% endif %}
    {% if stats.fare_amount %}
    <div class="stat-card">
        <div class="stat-label">Tarifa ($)</div>
        <div class="stat-value">${{ "%.2f"|format(stats.fare_amount.mean) }}</div>
        <div class="stat-detail">
            Mediana: ${{ "%.2f"|format(stats.fare_amount.median) }}<br>
            Mín: ${{ "%.2f"|format(stats.fare_amount.min) }}<br>
            Máx: ${{ "%.2f"|format(stats.fare_amount.max) }}<br>
            Desv. Estándar: ${{ "%.2f"|format(stats.fare_amount.std) }}
        </div>
    </div>
    {% endif %}
</div>

<!-- Gráficos -->
<div class="charts-grid">
    <div class="chart-card">
        <h3 class="chart-title">Distribución de Distancias de Viaje</h3>
        <div class="chart-container"><canvas id="distanciaChart"></canvas></div>
    </div>
    <div class="chart-card">
        <h3 class="chart-title">Distribución de Tarifas</h3>
        <div class="chart-container"><canvas id="tarifaChart"></canvas></div>
    </div>
    <div class="chart-card">
        <h3 class="chart-title">Pasajeros por Viaje</h3>
        <div id="passengerPlot"></div>
    </div>
    <div class="chart-card">
        <h3 class="chart-title">Scatter Distancia vs Precio</h3>
        <div id="scatterPlot"></div>
    </div>
</div>

<!-- Tabla -->
<div class="data-table">
    <h3 class="chart-title">Información del Dataset</h3>
    <table>
        <thead>
            <tr>
                <th>Columna</th>
                <th>Tipo de Dato</th>
                <th>Valores Nulos</th>
            </tr>
        </thead>
        <tbody>
            {% for col in stats.columnas %}
            <tr>
                <td><strong>{{ col }}</strong></td>
                <td>{{ stats.tipos_datos[col] }}</td>
                <td>{{ stats.valores_nulos[col] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<footer>
    <p>Dashboard creado con Flask + Chart.js + Plotly | Proyecto Big Data</p>
</footer>
</div>

<script>
const colors = {
    primary:'rgba(102,126,234,0.8)',
    secondary:'rgba(118,75,162,0.8)',
    success:'rgba(75,192,192,0.8)',
    warning:'rgba(255,206,86,0.8)',
    danger:'rgba(255,99,132,0.8)'
};

fetch('/api/graficos')
.then(res => res.json())
.then(data => {
    // Chart.js Distancia
    if(data.distancia){
        new Chart(document.getElementById('distanciaChart'), {
            type: 'bar',
            data: { labels: data.distancia.labels, datasets:[{ label:'Cantidad de Viajes', data: data.distancia.values, backgroundColor:'rgba(102,126,234,0.8)'}] },
            options:{ responsive:true, maintainAspectRatio:false, scales:{ y:{ beginAtZero:true } } }
        });
    }

    // Chart.js Tarifa
    if(data.tarifa){
        new Chart(document.getElementById('tarifaChart'), {
            type: 'line',
            data: { labels: data.tarifa.labels, datasets:[{ label:'Cantidad de Viajes', data:data.tarifa.values, backgroundColor:'rgba(118,75,162,0.2)', borderColor:'rgba(118,75,162,1)', fill:true, tension:0.4 }] },
            options:{ responsive:true, maintainAspectRatio:false, scales:{ y:{ beginAtZero:true } } }
        });
    }

    // Plotly Pasajeros
    if(data.pasajeros){
        const passengerData = {
            data: [{ x: data.pasajeros.labels.map(x => x + ' pasajeros'), y: data.pasajeros.values, type:'bar', marker:{color:'rgba(102,126,234,0.8)'} }],
            layout: { title:'Pasajeros por Viaje', height:400, margin:{ t:40 } }
        };
        Plotly.newPlot('passengerPlot', passengerData.data, passengerData.layout);
    }

    // Plotly Scatter
    if(data.correlaciones){
    Plotly.newPlot('scatterPlot', data.correlaciones.data, data.correlaciones.layout);
    }
})
.catch(err => console.error('Error al cargar gráficos:', err));
fetch('/api/graficos')
.then(res => res.json())
.then(data => {
    // Chart.js Distancia
    if(data.distancia){
        new Chart(document.getElementById('distanciaChart'), {
            type: 'bar',
            data: { labels: data.distancia.labels, datasets:[{ label:'Cantidad de Viajes', data: data.distancia.values, backgroundColor:'rgba(102,126,234,0.8)'}] },
            options:{ responsive:true, maintainAspectRatio:false, scales:{ y:{ beginAtZero:true } } }
        });
    }

    // Chart.js Tarifa
    if(data.tarifa){
        new Chart(document.getElementById('tarifaChart'), {
            type: 'line',
            data: { labels: data.tarifa.labels, datasets:[{ label:'Cantidad de Viajes', data:data.tarifa.values, backgroundColor:'rgba(118,75,162,0.2)', borderColor:'rgba(118,75,162,1)', fill:true, tension:0.4 }] },
            options:{ responsive:true, maintainAspectRatio:false, scales:{ y:{ beginAtZero:true } } }
        });
    }

    // Plotly Pasajeros
    if(data.pasajeros){
    Plotly.newPlot('passengerPlot', [{
        x: data.pasajeros.labels.map(x => x + ' pasajeros'),
        y: data.pasajeros.values,
        type:'bar',
        marker:{color:colors.primary}
    }], { title:'Pasajeros por Viaje', height:400, margin:{ t:40 } });
}


})
.catch(err => console.error('Error al cargar gráficos:', err));

</script>
</body>
</html>
